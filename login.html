<?php
    session_start();
?>
<html>
    <head>
        <title>
            Login
        </title>
    </head>
    <body>
        <center>
        <form action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>" method="post">
            <table>
            <tr> <td>Username:</td><td> <input id="user" name="username" type="text" required/> </td></tr>
            <tr> <td>Password:</td><td> <input id="pass" name="pass" type="password" required/> </td></tr>
            <tr> <td></td><td><input type="submit" value="Log in" /></td>
            </table>
        </form>
        <?php
            $username = $pass = "";
            function test_input($data) {
                $data = trim($data);
                $data = stripslashes($data);
                $data = htmlspecialchars($data);
                return $data;
            }
            if ($_SERVER["REQUEST_METHOD"] == "POST") {
                $user = test_input($_POST["username"]);
                $pass = test_input($_POST["pass"]);
                $servername = "dijkstra.cs.bilkent.edu.tr";
                $username = "endi.merkuri";
                $password = "qKy7pwmv";
                $dbname = "endi_merkuri";
                // Create connection
                $con = new mysqli($servername, $username, $password, $dbname);
                
                // Check connection
                if ($con->connect_error) {
                    die("Connection failed: " . $con->connect_error);
                }     
                $stmt = $con->prepare("SELECT cid FROM customer WHERE name = ?");
                $stmt->bind_param("s", $user);
                $stmt->execute();
                $stmt->bind_result($result);
                $stmt->fetch();
                if ( $result == $pass ) {
                    $_SESSION['username'] = $user;
                    $_SESSION['cid'] = $pass;
                    header('Location: welcome.php');
                } else {
                    echo "Wrong username or password";
                }
                $stmt->close();
                $con->close();
            }
        ?>
        </center>
    </body>
</html>